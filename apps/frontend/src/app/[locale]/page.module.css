.cube {
  position: relative;
  width: 160px;
  height: 160px;
  transform-style: preserve-3d;
}

/* Entrance animation - elements start invisible and fade in */
.cubeEntrance {
  opacity: 0;
  animation-name: cubeEntrance;
  animation-duration: 400ms;
  animation-timing-function: cubic-bezier(0.16, 1, 0.3, 1);
  animation-fill-mode: forwards;
}

@keyframes cubeEntrance {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Stage 1: Inner cube sharp fade-in animation */
.innerCubeStage1 {
  opacity: 0;
  animation-name: innerCubeStage1FadeIn;
  animation-fill-mode: forwards;
}

@keyframes innerCubeStage1FadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Prevent animations until entrance completes */
.cubeEntrancePending .cubePulseFace,
.cubeEntrancePending .innerCube {
  animation-play-state: paused;
  opacity: 0;
}

.stage2SimulatedFaces {
  position: absolute;
  inset: 0;
  transform-style: preserve-3d;
  pointer-events: none;
  z-index: 1;
}

.stage2Face {
  position: absolute;
  width: 100%;
  height: 100%;
  will-change: opacity;
  opacity: 0;
}

.stage2FaceCrash {
  /* Animation properties are set via CSS variables to support dual animations (fade-in + crash) */
  will-change: transform, opacity;
  animation-name: stage2FaceFadeIn, stage2FaceCrash;
  animation-duration: var(--stage2-fade-duration, 300ms), var(--stage2-crash-duration, 400ms);
  animation-delay: var(--stage2-fade-delay, 0ms), var(--stage2-crash-delay, 0ms);
  /* Ease-out for fade-in, custom timing for crash (ease-out for backstep, then strong ease-in for crash) */
  animation-timing-function:
    cubic-bezier(0.16, 1, 0.3, 1), var(--stage2-crash-easing, cubic-bezier(0.25, 0.46, 0.45, 0.94));
  /* forwards for fade-in (keep opacity: 1 after), forwards for crash (don't apply initial state before delay) */
  animation-fill-mode: forwards, forwards;
}

.stage2SimulatedFacesImpact {
  animation: stage2ImpactJiggle var(--stage2-jiggle-duration, 500ms) ease-out;
}

/* Impact bounce applied to the entire cube */
.cubeImpact {
  animation: stage2ImpactJiggle var(--stage2-jiggle-duration, 500ms) ease-out;
}

@keyframes stage2FaceFadeIn {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}

@keyframes stage2FaceCrash {
  0% {
    opacity: 1;
    transform: var(--stage2-transform-start);
  }
  15% {
    opacity: 1;
    transform: var(--stage2-transform-start); /* brief hold */
  }
  /* Backstep phase: ease-out movement from start to backstep position (15% to 35%)
   * Keyframes spaced to create ease-out effect: faster at start, slower at end
   * We interpolate between start and backstep transforms */
  20% {
    opacity: 1;
    transform: var(--stage2-transform-start); /* still at start, beginning of backstep */
  }
  28% {
    opacity: 1;
    transform: var(--stage2-transform-backstep); /* quickly move to backstep (ease-out: fast start) */
  }
  35% {
    opacity: 1;
    transform: var(--stage2-transform-backstep); /* hold at backstep position */
  }
  /* Jiggle during backstep: oscillate around backstep position (35% to 70%) */
  38% {
    opacity: 1;
    transform: var(--stage2-transform-backstep) rotateX(5deg) translateZ(5px);
  }
  42% {
    opacity: 1;
    transform: var(--stage2-transform-backstep) rotateX(-5deg) translateZ(-4px);
  }
  46% {
    opacity: 1;
    transform: var(--stage2-transform-backstep) translateY(-8px) translateZ(3px);
  }
  50% {
    opacity: 1;
    transform: var(--stage2-transform-backstep) rotateZ(5deg) translateZ(-2.5px);
  }
  54% {
    opacity: 1;
    transform: var(--stage2-transform-backstep) translateZ(2px);
  }
  58% {
    opacity: 1;
    transform: var(--stage2-transform-backstep) translateZ(-1.5px);
  }
  62% {
    opacity: 1;
    transform: var(--stage2-transform-backstep) translateZ(1px);
  }
  66% {
    opacity: 1;
    transform: var(--stage2-transform-backstep) translateZ(-0.5px);
  }
  70% {
    opacity: 1;
    transform: var(--stage2-transform-backstep); /* jiggle settles, ready for crash */
  }
  /* Crash phase: smooth acceleration to final position (70% to 100%) */
  100% {
    transform: var(--stage2-transform-end);
    opacity: 1;
  }
}

/* Combined animation: fade-in followed by crash motion
 * Total duration: 300ms (fade) + 400ms (crash) = 700ms
 * Fade: 0% to 42.86% (300/700)
 * Crash hold: 42.86% to 51.43% (60ms = 15% of 400ms crash phase)
 * Crash backstep: 51.43% to 57.14% (100ms = 25% of 400ms crash phase)
 * Crash accelerate: 57.14% to 100%
 */
@keyframes stage2FaceFadeInAndCrash {
  /* Fade-in phase: 0% to 42.86% */
  0% {
    opacity: 0;
    transform: var(--stage2-transform-start);
  }
  42.86% {
    opacity: 1;
    transform: var(--stage2-transform-start);
  }
  /* Hold phase: 42.86% to 51.43% */
  51.43% {
    opacity: 1;
    transform: var(--stage2-transform-start); /* brief hold */
  }
  /* Backstep phase: 51.43% to 57.14% */
  57.14% {
    opacity: 1;
    transform: var(--stage2-transform-backstep); /* slight backward move to gain momentum */
  }
  /* Crash phase: 57.14% to 100% */
  100% {
    transform: var(--stage2-transform-end);
    opacity: 1;
  }
}

@keyframes stage2ImpactJiggle {
  0% {
    transform: translateZ(0);
  }
  35% {
    transform: translateZ(12px);
  }
  65% {
    transform: translateZ(-8px);
  }
  100% {
    transform: translateZ(0);
  }
}
.followWrapper {
  transform-style: preserve-3d;
  transition: transform 0.1s ease-out; /* Smooth transition for mouse follow */
}

/* Cube implosion animation: shrink to point while rotating */
.cubeImplode {
  animation: cubeImplode var(--implosion-duration, 600ms) cubic-bezier(0.4, 0, 0.2, 1) forwards;
  animation-delay: 0ms;
  /* Disable transition during implosion to allow animation to take precedence */
  transition: none;
}

@keyframes cubeImplode {
  0% {
    transform: scale(1) rotateX(0deg) rotateY(0deg) rotateZ(0deg);
  }
  100% {
    transform: scale(0) rotateX(720deg) rotateY(720deg) rotateZ(720deg);
  }
}

.cubeFace {
  position: absolute;
  width: 100%;
  height: 100%;
  background: var(--cube-face-background, rgba(31, 41, 55, 0.6));
  border: 1px solid var(--cube-face-border, rgba(26, 28, 32, 0.6));
  box-shadow: inset 0 0 24px var(--cube-face-shadow, rgba(0, 0, 0, 0.25));
  will-change: transform;
  transform: translateZ(0);
}

.cubePulseWrapper {
  position: absolute;
  inset: 0;
  transform-style: preserve-3d;
  pointer-events: none;
  will-change: transform;
  transform-origin: center;
}

.cubePulsePaused .cubePulseFace {
  animation-play-state: paused;
}

.cubePulse {
  position: absolute;
  inset: 0;
  transform-style: preserve-3d;
}

.cubePulseFace {
  position: absolute;
  width: 100%;
  height: 100%;
  background: var(--cube-pulse-face-bg, rgba(31, 41, 25, 0.18));
  border: 1px solid var(--cube-pulse-border-color, rgba(191, 219, 254, 0.35));
  box-shadow:
    0 0 var(--cube-pulse-glow-radius, 48px) var(--cube-pulse-glow-color, rgba(148, 181, 255, 0.5)),
    inset 0 0 calc(var(--cube-pulse-glow-radius, 48px) * 0.35) var(--cube-pulse-glow-color, rgba(148, 181, 255, 0.5));
  will-change: opacity, transform;
  backface-visibility: visible;
  transform-style: preserve-3d;
  pointer-events: none;
  animation-name: cubePulseFace;
  animation-duration: calc(var(--cube-pulse-duration, 1200ms) + var(--cube-pulse-loop-delay, 400ms));
  animation-timing-function: var(--cube-pulse-easing, cubic-bezier(0.16, 1, 0.3, 1));
  animation-iteration-count: infinite;
  animation-delay: var(--cube-pulse-delay, 0ms);
  animation-fill-mode: both;
}

.cubePulseFace::before,
.cubePulseFace::after {
  content: '';
  position: absolute;
  inset: 0;
  border: inherit;
  background: inherit;
  opacity: var(--cube-pulse-edge-opacity, 0.42);
  box-shadow: 0 0 var(--cube-pulse-edge-blur, 42px) var(--cube-pulse-glow-color, rgba(148, 181, 255, 0.5));
  pointer-events: none;
  mix-blend-mode: screen;
}

.cubePulseFace::before {
  transform: translateZ(var(--cube-pulse-half-thickness, 5px));
}

.cubePulseFace::after {
  transform: translateZ(calc(var(--cube-pulse-half-thickness, 5px) * -1)) rotateY(180deg);
}

.cubePulseFaceSecondary {
  --cube-pulse-loop-delay: var(--cube-pulse-secondary-loop-delay, var(--cube-pulse-loop-delay, 400ms));
  animation-delay: var(--cube-pulse-secondary-delay, 200ms);
}

.cubeFront {
  transform: rotateY(0deg) translateZ(80px);
  border-width: 3px;
}
.cubeBack {
  transform: rotateY(180deg) translateZ(80px);
}
.cubeRight {
  transform: rotateY(90deg) translateZ(80px);
}
.cubeLeft {
  transform: rotateY(-90deg) translateZ(80px);
}
.cubeTop {
  transform: rotateX(90deg) translateZ(80px);
}
.cubeBottom {
  transform: rotateX(-90deg) translateZ(80px);
}

.innerCube {
  position: relative;
  width: 100%;
  height: 100%;
  transform-style: preserve-3d;
  transform-origin: center center;
  pointer-events: none;
  animation-name: innerCubePulse;
  animation-duration: calc(var(--cube-pulse-duration, 1200ms) + var(--cube-pulse-loop-delay, 400ms));
  animation-timing-function: var(--cube-pulse-easing, cubic-bezier(0.16, 1, 0.3, 1));
  animation-iteration-count: infinite;
  animation-delay: var(--cube-pulse-delay, 0ms);
  animation-fill-mode: both;
}

.cubePulsePaused .innerCube {
  animation-play-state: paused;
}

@keyframes innerCubePulse {
  /* First pulse: start at 0% (matching outer cube primary pulse start) */
  0% {
    transform: scale3d(1, 1, 1);
  }

  /* First pulse: expand over 100ms (0ms to 100ms = 0% to 6.25%) */
  6.25% {
    transform: scale3d(
      var(--inner-cube-pulse-scale, 1.15),
      var(--inner-cube-pulse-scale, 1.15),
      var(--inner-cube-pulse-scale, 1.15)
    );
  }

  /* First pulse: shrink over 100ms */
  12.5% {
    transform: scale3d(1.05, 1.05, 1.05);
  }

  /* Second pulse: expand over 100ms to reach peak at 18.75% */
  18.75% {
    transform: scale3d(
      var(--inner-cube-pulse-scale, 1.25),
      var(--inner-cube-pulse-scale, 1.25),
      var(--inner-cube-pulse-scale, 1.25)
    );
  }

  80% {
    transform: scale3d(1, 1, 1);
  }

  /* Hold until loop repeats */
  100% {
    transform: scale3d(1, 1, 1);
  }
}

.innerCubeFace {
  background: var(--inner-cube-face-background, rgba(31, 41, 55, 0.18));
  border: 1px solid var(--inner-cube-face-border, rgba(19, 21, 25, 0.75));
  box-shadow: inset 0 0 12px var(--inner-cube-face-shadow, rgba(0, 0, 0, 0.2));
}

.cornerMarker {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  transform-style: preserve-3d;
  pointer-events: none;
}

.guideOverlay {
  position: absolute;
  inset: 0;
  z-index: 15;
  pointer-events: none;
  width: 100%;
  height: 100%;
}

.guideOverlay line {
  stroke-width: 1px;
  transition: opacity 0.2s ease;
}

.cursorGuideLine {
  opacity: 0;
  transition: opacity 0.3s ease;
}

.cursorGuideVisible {
  opacity: 1;
}

.guideOverlay line[data-testid='tesseract-connecting-line'] {
  stroke-width: var(--tesseract-line-stroke-width, 1px);
  stroke: var(--tesseract-line-color, rgba(26, 28, 32, 0.4));
  /* Initial state: line is hidden (stroke-dashoffset equals line length, opacity 0) */
  stroke-dasharray: var(--line-length, 0);
  stroke-dashoffset: var(--line-length, 0);
  opacity: 0;
}

.guideOverlay line[data-testid='tesseract-connecting-line'].stage3LineGrowth {
  /* Dual animation: fade in + grow from inner to outer */
  animation-name: stage3LineFadeIn, stage3LineGrowth;
  animation-duration: var(--stage3-fade-duration, 300ms), var(--stage3-growth-duration, 600ms);
  animation-delay: var(--stage3-growth-delay, 0ms), var(--stage3-growth-delay, 0ms);
  animation-timing-function: ease-out, var(--stage3-growth-easing, cubic-bezier(0.16, 1, 0.3, 1));
  animation-fill-mode: forwards, forwards;
}

@keyframes stage3LineFadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes stage3LineGrowth {
  from {
    stroke-dashoffset: var(--line-length, 0);
  }
  to {
    stroke-dashoffset: 0;
  }
}

.paused {
  animation-play-state: paused;
}

/* Cursor styling */
.landingPage {
  cursor:
    url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><defs><radialGradient id="cursorGradient" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="rgb(34, 42, 55)" stop-opacity="0.2"/><stop offset="100%" stop-color="rgb(34, 42, 55)" stop-opacity="0.6"/></radialGradient></defs><circle cx="12" cy="12" r="6" fill="url(%23cursorGradient)"/></svg>')
      12 12,
    auto;
}

@keyframes cubePulseFace {
  0% {
    transform: var(--cube-pulse-transform-start);
    opacity: var(--cube-pulse-opacity-start, 0.7);
  }

  65% {
    transform: var(--cube-pulse-transform-end);
    opacity: var(--cube-pulse-opacity-mid, 0.3);
  }

  100% {
    transform: var(--cube-pulse-transform-end);
    opacity: var(--cube-pulse-opacity-end, 0);
  }
}
